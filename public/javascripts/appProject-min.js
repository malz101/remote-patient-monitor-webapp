var bpmChartRef,tempChartRef,acclChartRef,date,time,lastTime;function ajax(e,t,a,n){var l=new XMLHttpRequest;l.open(t,e,!0),l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),l.onreadystatechange=function(){if(4==l.readyState&&200==l.status){var e=JSON.parse(l.responseText);console.log(e),1==e.status&&e.dataPoints.forEach((function(e){var t=new Date(e.time);date=t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear(),time=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),checkForCriticalVitals(e),updateVitals(e),updateTable(e),updateCharts(e)})),n(l.responseText)}},l.send(JSON.stringify(a))}function checkForCriticalVitals(e){var t="ATTENTION!:\n";e.bpm>100&&(t+="Patient Heart Rate is critical!\n"),(e.temp<25||e.temp>40)&&(t+="Patient Temperature is critical!\n"),"FELL!"==e.alert&&(t+="Patient has FALLEN!\n"),"HELP!"==e.alert&&(t+="Patient needs HELP!\n");var a=document.getElementById("errorArea");a.innerText="ATTENTION!:\n"!=t?t:""}function updateVitals(e){var t=document.getElementById("bpm"),a=document.getElementById("temp"),n=document.getElementById("pos"),l=document.getElementById("accl");t.innerText=e.bpm+"bpm",a.innerText=e.temp+"°C",n.innerText=e.pos,l.innerText=e.accl+"m/s"}function updateTable(e){var t=document.getElementById("patientTable").insertRow(2),a=t.insertCell(0),n=t.insertCell(1),l=t.insertCell(2),r=t.insertCell(3),s=t.insertCell(4),i=t.insertCell(5),d=t.insertCell(6),o=t.insertCell(7);a.innerHTML=e.id,n.innerHTML=e.bpm,l.innerHTML=e.temp,r.innerHTML=e.pos,s.innerHTML=e.accl,i.innerHTML=e.alert,d.innerHTML=time,o.innerHTML=date}function updateCharts(e){bpmChartRef.data.datasets[0].data.length>100&&(bpmChartRef.data.labels.splice(0,1),bpmChartRef.data.datasets[0].data.splice(0,1)),bpmChartRef.data.labels.push(time),bpmChartRef.data.datasets[0].data.push(e.bpm),bpmChartRef.update(),tempChartRef.data.datasets[0].data.length>100&&(tempChartRef.data.labels.splice(0,1),tempChartRef.data.datasets[0].data.splice(0,1)),tempChartRef.data.labels.push(time),tempChartRef.data.datasets[0].data.push(e.temp),tempChartRef.update(),acclChartRef.data.datasets[0].data.length>100&&(acclChartRef.data.labels.splice(0,1),acclChartRef.data.datasets[0].data.splice(0,1)),acclChartRef.data.labels.push(time),acclChartRef.data.datasets[0].data.push(e.accl),acclChartRef.update()}function renderBpmChart(){var e=document.getElementById("bpmCanvas").getContext("2d");bpmChartRef=new Chart(e,{type:"line",data:{labels:[],datasets:[{label:"Beats per Minute (bpm)",fill:!1,lineTension:.1,backgroundColor:"rgba(192,75,192,0.4)",borderColor:"rgba(192,75,192,1)",borderCapStyle:"butt",borderJoinStyle:"miter",data:[],fill:!1}]},options:{legend:{display:!1},responsive:!0,title:{display:!0,text:"Chart Showing Patient's Heart Rate"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Beats Per Minute (bpm)"}}]}}})}function renderTempChart(){var e=document.getElementById("hrCanvas").getContext("2d");tempChartRef=new Chart(e,{type:"line",data:{labels:[],datasets:[{label:"Temperature (°C)",fill:!1,lineTension:.1,backgroundColor:"rgba(67,75,192,0.4)",borderColor:"rgba(67,75,192,1)",borderCapStyle:"butt",borderJoinStyle:"miter",data:[],fill:!1}]},options:{legend:{display:!1},responsive:!0,title:{display:!0,text:"Chart Showing Patient's Temperature"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Temperature (°C)"}}]}}})}function renderAcclChart(){var e=document.getElementById("acclCanvas").getContext("2d");acclChartRef=new Chart(e,{type:"line",data:{labels:[],datasets:[{label:"Accleration (m/s)",fill:!1,lineTension:.1,backgroundColor:"rgba(75,192,192,0.4)",borderColor:"rgba(75,192,192,1)",borderCapStyle:"butt",borderJoinStyle:"miter",data:[],fill:!1}]},options:{legend:{display:!1},responsive:!0,title:{display:!0,text:"Chart Showing Patient's Acceleration"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Acceleration (m/s)"}}]}}})}renderBpmChart(),renderTempChart(),renderAcclChart(),document.getElementById("table-button").addEventListener("click",(function(){var e=document.getElementById("tableSection"),t=document.getElementById("table-button");"none"===e.style.display||""===e.style.display?(e.style.display="block",t.innerText="Hide Table"):(e.style.display="none",t.innerText="Show Table")})),setInterval((function(){ajax("/addDatatoChart","POST",{id:"0001"},()=>{})}),1e3);